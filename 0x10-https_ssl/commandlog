sudo apt update
sudo apt install snapd
sudo snap install core; sudo snap refresh core
sudo apt-get remove certbot
#sudo apt-get install certbot
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
#Choose how you'd like to run Certbot

# Yes, my web server is not currently running on this machine.
Stop your webserver, then run this command to get a certificate. Certbot will temporarily spin up a webserver on your machine ===> sudo certbot certonly --standalone

#No, I need to keep my web server running.
If you have a webserver that's already using port 80 and don't want to stop it while Certbot runs, run this command and follow the instructions in the terminal ===> sudo certbot certonly --webroot

# use 
sudo certbot certonly --standalone --preferred-challenges http --http-01-port 80 -d effiongsamuel.tech -d www.effiongsamuel.tech

# or 
sudo certbot certonly --standalone --preferred-challenges http --http-01-address 54.237.124.39 --http-01-port 80 -d effiongsamuel.tech --non-interactive --agree-tos --email samueleffiongjacob@gmail.com

#or 
sudo certbot certonly --standalone --preferred-challenges http --http-01-port 80 -d effiongsamuel.tech --non-interactive --agree-tos --email samueleffiongjacob@gmail.com

#Could not bind TCP port 80 because it is already in use by another process on this system (such as a web server). Please stop the program in question and then try again.

# then run =======> 
#sudo lsof -i tcp:80
#sudo lsof -t -i tcp:80 -s tcp:listen | sudo xargs kill

# run comman above .



sudo ls /etc/letsencrypt/live/effiongsamuel.tech
sudo mkdir -p /etc/haproxy/certs
DOMAIN='effiongsamuel.tech' sudo -E bash -c 'cat /etc/letsencrypt/live/$DOMAIN/fullchain.pem /etc/letsencrypt/live/$DOMAIN/privkey.pem > /etc/haproxy/certs/$DOMAIN.pem'

# or 
sudo cat "/etc/letsencrypt/live/example.com/fullchain.pem" "/etc/letsencrypt/live/example.com/privkey.pem" > "/etc/ssl/effiongsamuel.tech.pem"

sudo chmod -R go-rwx /etc/haproxy/certs
sudo vi /etc/haproxy/haproxy.cfg
sudo service haproxy restart

/etc/haproxy/certs/effiongsamuel



see what is the port
sudo lsof -i tcp:80

kill it
sudo lsof -t -i tcp:80 -s tcp:listen | sudo xargs kill

use full website

https://certbot.eff.org/instructions?ws=haproxy&os=ubuntufocal

https://dev.to/phansch/setting-up-ssl-certificates-for-haproxy-with-certbot-bb0

https://serversforhackers.com/c/letsencrypt-with-haproxy

https://markontech.com/linux/install-lets-encrypt-ssl-on-haproxy/

https://www.linuxtechi.com/how-to-setup-haproxy-ssl-termination-ubuntu/


'/etc/haproxy/haproxy.cfg'





"
defaults
  mode http
  option httplog
  option  dontlognull
  timeout client 5000
  timeout connect 5000
  timeout server 5000
  timeout http-request 5000
  errorfile 400 /etc/haproxy/errors/400.http
  errorfile 403 /etc/haproxy/errors/403.http
  errorfile 408 /etc/haproxy/errors/408.http
  errorfile 500 /etc/haproxy/errors/500.http
  errorfile 502 /etc/haproxy/errors/502.http
  errorfile 503 /etc/haproxy/errors/503.http
  errorfile 504 /etc/haproxy/errors/504.http

frontend effiongsamuel-tech-backend
    bind 3.85.1.64:80
    default_backend effiongsamuel-tech-backend

backend effiongsamuel_tech_backend
    balance roundrobin
    server 139694-web-01 100.26.178.1:80 check
    server 139694-web-02 34.202.157.245:80 check

listen stats
   bind *:8080
   stats enable
   stats uri /
   stats refresh 5s
   stats realm Haproxy\ Statistics
"



# haproxy  new setup

#!/usr/bin/env bash
# configures a new HAproxy as a load balancer

# Install HAproxy on a server
apt-get -y update
apt-get -y install haproxy=1.6.\*

# Configure haproxy configuration file to distribute requests using a roundrobin algorithm
echo '
frontend www.effiongsamuel.tech
        bind 0:80
        default_backend effiongsamuel_tech_backend

backend effiongsamuel_tech_backend
        balance roundrobin
        server 139694-web-02 34.202.157.245:80
        server 139694-web-01 100.26.178.1:80
' >> /etc/haproxy/haproxy.cfg

# Restart HAproxy service
sudo service haproxy restart