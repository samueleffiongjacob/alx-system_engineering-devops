sudo apt update
sudo apt install snapd
sudo snap install core; sudo snap refresh core
sudo apt-get remove certbot
#sudo apt-get install certbot
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
#Choose how you'd like to run Certbot

# Yes, my web server is not currently running on this machine.
Stop your webserver, then run this command to get a certificate. Certbot will temporarily spin up a webserver on your machine ===> sudo certbot certonly --standalone

#No, I need to keep my web server running.
If you have a webserver that's already using port 80 and don't want to stop it while Certbot runs, run this command and follow the instructions in the terminal ===> sudo certbot certonly --webroot

sudo certbot certonly --standalone --preferred-challenges http --http-01-port 80 -d effiongsamuel.tech -d www.effiongsamuel.tech
sudo ls /etc/letsencrypt/live/your_domain_name
sudo mkdir -p /etc/haproxy/certs
DOMAIN='example.com' sudo -E bash -c 'cat /etc/letsencrypt/live/$DOMAIN/fullchain.pem /etc/letsencrypt/live/$DOMAIN/privkey.pem > /etc/haproxy/certs/$DOMAIN.pem'
sudo chmod -R go-rwx /etc/haproxy/certs
sudo nano /etc/haproxy/haproxy.cfg
sudo service haproxy restart

/etc/haproxy/certs/effiongsamuel

sudo certbot certonly --webroot
samueleffiong685@gmail.com
/etc/letsencrypt

sudo certbot certonly --standalone --preferred-challenges http --http-01-port 80 -d linuxtechgeek.info -d www.linuxtechgeek.info

sudo certbot certonly --standalone --preferred-challenges http --http-01-port 80 -d effiongsamuel.tech -d www.effiongsamuel.tech

sudo certbot certonly --standalone --preferred-challenges http --http-01-port 8080 -d effiongsamuel.tech -d www.effiongsamuel.tech
#or

sudo certbot certonly --standalone -d effiongsamuel.tech --non-interactive --http-01-port=8888

sudo certbot certonly --standalone  --preferred-challenges http --http-01-port 80
certbot-auto certonl




sudo lsof -t -i tcp:80 -s tcp:listen | sudo xargs kill

![Could not bind TCP port 80 because it is already in use by another process on this system (such as a web server)](https://9to5tutorial.com/could-not-bind-tcp-port-80-because-it-is-already-in-use-by-another-process-on-this-system-such-as-a-web-server)


see what is the port
sudo lsof -i tcp:80

kill it
sudo lsof -t -i tcp:80 -s tcp:listen | sudo xargs kill

contunu

https://certbot.eff.org/instructions?ws=haproxy&os=ubuntufocal

https://dev.to/phansch/setting-up-ssl-certificates-for-haproxy-with-certbot-bb0

https://serversforhackers.com/c/letsencrypt-with-haproxy

results=$(Sudo lsof -i :80 |grep  ipv4)


//using letsencrypt web.
/etc/letsencrypt
sudo add-apt-repository -y ppa:certbot/certbot
sudo apt-get update
sudo apt-get install -y certbot

sudo certbot certonly --standalone -d www.effiongsamuel.tech --non-interactive --agree-tos --email samueleffiong685@gmail.com  --http-01-port=8888

sudo certbot certonly --standalone --preferred-challenges http --http-01-port 80 -d linuxtechgeek.info -d www.linuxtechgeek.info
sudo certbot certonly --standalone --preferred-challenges http --http-01-port 80 -d effiongsamuel.tech -d www.effiongsamuel.tech
sudo certbot certonly --standalone --preferred-challenges http --TLS-SNI-01-port 443 -d effiongsamuel.tech -d www.effiongsamuel.tech

 TLS-SNI-01
-d effiongsamuel.tech
 /etc/letsencrypt
  /etc/letsencrypt

'/etc/haproxy/haproxy.cfg'

## error message
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Plugins selected: Authenticator standalone, Installer None
Obtaining a new certificate
Performing the following challenges:
http-01 challenge for effiongsamuel.tech
Waiting for verification...
Challenge failed for domain effiongsamuel.tech
http-01 challenge for effiongsamuel.tech
Cleaning up challenges
Some challenges have failed.

IMPORTANT NOTES:
 - The following errors were reported by the server:

   Domain: effiongsamuel.tech
   Type:   unauthorized
   Detail: 34.202.157.245: Invalid response from
   http://effiongsamuel.tech/.well-known/acme-challenge/YBHC2847ChCb24KngrwN_dBY5OHcB5UdhSvuRmVFIZU:
   404

   To fix these errors, please make sure that your domain name was
   entered correctly and the DNS A/AAAA record(s) for that domain
   contain(s) the right IP address.



# new way.
https://www.linuxtechi.com/how-to-setup-haproxy-ssl-termination-ubuntu/

"
defaults
  mode http
  option httplog
  option  dontlognull
  timeout client 5000
  timeout connect 5000
  timeout server 5000
  timeout http-request 5000
  errorfile 400 /etc/haproxy/errors/400.http
  errorfile 403 /etc/haproxy/errors/403.http
  errorfile 408 /etc/haproxy/errors/408.http
  errorfile 500 /etc/haproxy/errors/500.http
  errorfile 502 /etc/haproxy/errors/502.http
  errorfile 503 /etc/haproxy/errors/503.http
  errorfile 504 /etc/haproxy/errors/504.http

frontend effiongsamuel-tech-backend
    bind 3.85.1.64:80
    default_backend effiongsamuel-tech-backend

backend effiongsamuel_tech_backend
    balance roundrobin
    server 139694-web-01 100.26.178.1:80 check
    server 139694-web-02 34.202.157.245:80 check

listen stats
   bind *:8080
   stats enable
   stats uri /
   stats refresh 5s
   stats realm Haproxy\ Statistics
"



# haproxy  new setup

#!/usr/bin/env bash
# configures a new HAproxy as a load balancer

# Install HAproxy on a server
apt-get -y update
apt-get -y install haproxy=1.6.\*

# Configure haproxy configuration file to distribute requests using a roundrobin algorithm
echo '
frontend www.effiongsamuel.tech
        bind 0:80
        default_backend effiongsamuel_tech_backend

backend effiongsamuel_tech_backend
        balance roundrobin
        server 139694-web-02 34.202.157.245:80
        server 139694-web-01 100.26.178.1:80
' >> /etc/haproxy/haproxy.cfg

# Restart HAproxy service
sudo service haproxy restart